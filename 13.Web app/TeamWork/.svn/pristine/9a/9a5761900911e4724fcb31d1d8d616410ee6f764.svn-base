namespace Chess.Server.Repos
{
    using System.Data.Entity;
    using Chess.Model;
    using System;
    using System.Linq;

    public class GameRepository : EfRepository<Game>
    {
        public GameRepository(DbContext context) : base(context)
        {
        }

        public Game FindNewGame()
        {
            Game game = this.DbSet.FirstOrDefault(x => x.GameStatus.StatusName == "Penging");
            if (game == null)
            {
                game = new Game()
                {
                    StatusId = this.Context.Set<GameStatus>().First(x => x.StatusName == "Penging").Id
                };
                this.Add(game);
            }
            else
            {
                game.StatusId = this.Context.Set<GameStatus>().First(x => x.StatusName == "Active").Id;
            }

            return game;
        }
    }
}