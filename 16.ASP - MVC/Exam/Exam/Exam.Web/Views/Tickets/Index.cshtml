@using Exam.Web.Models;
@model IEnumerable<TicketViewModel>

@{
    ViewBag.Title = "Ticket list";
}

<h2>@ViewBag.Title</h2>


<div class="row-fluid">
    @using (Html.BeginForm("Search", "Tickets", FormMethod.Post))
    {
        <div>
            Search by category
        </div>
        @(Html.Kendo()
        .DropDownList()
        .Name("categorysearch")
        .DataTextField("CategoryName")
        .DataValueField("CategoryId")
        .OptionLabel("All")
        .DataSource(data =>
        {
            data.Read(read => read.Action("GetTicketCategoryData", "Tickets"));
            data.ServerFiltering(true);
        }))

        <div>
            <input type="submit" value="Search" class="btn" />
        </div>

    }
</div>
<br />

@(Html.Kendo()
    .ListView<TicketViewModel>()
    .Name("tickets")
    .TagName("div")
    .ClientTemplateId("ticket-template")
    .Pageable()
    .DataSource(data =>
    {
        data.Read("GetTickets", "Tickets");
        data.ServerOperation(true);
        data.PageSize(5);
    })
    .Events(ev => ev.DataBound("onListViewDataBound")))

@section scripts{
    <script>
        function onListViewDataBound() {
            $("<div class='row-fluid'>" +
            "<div class='span2' style='padding: 10px'>" +
                "<h3>Title</h3>" +
            "</div>" +
            "<div class='span3' style='padding: 10px'>" +
                "<h3>Category</h3>" +
            "</div>" +
            "<div class='span2' style='padding: 10px'>" +
                "<h3>Author</h3>" +
            "</div>" +
            "<div class='span2' style='padding: 10px'>" +
                "<h3>Priority</h3>" +
            "</div>" +
            "<div class='span2' style='padding: 10px'>" +
                "<h3>More details...</h3>" +
            "</div>" +
        "</div>")
                .insertBefore($("#tickets div:first-child").first());
        }
    </script>

    <script id="ticket-template" type="text/x-kendo-template">      
        <div class="row-fluid">
            <div class="span2" style="padding: 10px">
                <strong>#: Title #</strong>
            </div>
            <div class="span3" style="padding: 10px">
                <strong>#: CategoryName #</strong>
            </div>
            <div class="span2" style="padding: 10px">
                <strong>#: AuthorName #</strong>
            </div>
            <div class="span2" style="padding: 10px">
                <strong>#: PriorityAsString #</strong>
            </div>
            <div class="span2" style="padding: 10px">
                <strong><a href="/Tickets/Details?TicketId=#: TicketId #" class="btn">More details...</a></strong>
            </div>
        </div>
    </script>
}